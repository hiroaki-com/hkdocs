---
title: 2025-06-03 警察から電話が来た話など 今日の体調や雑記
authors: [hk]
hide_table_of_contents: false
---

### 作業

CI/CD化に苦戦中。認証周りの連携がうまくいかないようだ
SA権限の強弱調整と設定値の再確認で解決

<!-- truncate -->

### 以下、解決時の要点

**CI/CD (GitHub Actions + GCP Workload Identity Federation) トラブルシューティング要点**

##### 1.  **サービスアカウントへの `サービスアカウントトークン作成者` ロール付与漏れ:**
    *   Workload Identity Federationを使用する際、CI/CD用サービスアカウント自身がアクセストークンを生成するために必須。

##### 2.  **Workload Identity Federationのプリンシパル設定とサービスアカウントへの `Workload Identity ユーザー` ロールの紐付け不備:**
    *   GitHub Actionsから提示されるID (リポジトリ名、ブランチ名などを含むプリンシパル) と、GCP側で許可するプリンシパルの設定が完全に一致している必要がある。
    *   サービスアカウントの「権限」タブで、このGitHub Actionsからのプリンシパルに対して `Workload Identity ユーザー` ロールを正しく付与する必要がある。

##### 3.  **Workload Identity プールのプロバイダ設定における「属性マッピング」の不足:**
    *   `google.subject=assertion.sub` に加え、`attribute.repository=assertion.repository` のマッピングを追加することで、プリンシパルのリポジトリ属性の解釈が改善される場合がある。

##### 4.  **Workload Identity プールのプロバイダ設定における「属性条件」の不一致:**
    *   リポジトリ名やブランチ名の大文字・小文字を含めた完全一致が必要。不明な場合は一時的に条件を削除して切り分け。

##### 5.  **CI/CD用サービスアカウントのGCPリソース操作権限不足:**
    *   当初 `Cloud Run Developer` で試行したが、`Cloud Run Admin` で成功。デプロイに必要な権限が不足していた（サービス設定変更、IAMポリシー変更などを含む可能性）。




### 体調

本日の体調はとてもいい。

昨日は食事の量を減らして生活したことが良い影響を与えているか

耳栓をしてアイマスクをして睡眠を取ったことも良さそうだ

天気もいいのでそれも良いのかもしれない

### 雑記

午前中に作業をしていると、警察から電話があった

<!-- truncate -->

昨年末に自転車の盗難被害に遭っており、その件のようだ

中央区で駐車していた際に盗難に遭ったクロスバイクが豊平区内で見つかったらしい

最近、札幌市内では自転車の盗難が多発しているらしく、業者に売られているのだろうと

諦めていたところだっただけに、嬉しい

当日中に引き取りに来て欲しいと言われ、難しい旨を伝えた

すると、自宅まで届けてくれることになった

こんなこともあるのかと感じた一件であった