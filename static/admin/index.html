<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=3.0, user-scalable=yes" />
  <title>Content Manager</title>
  
  <style>
    /*
     * =================================================================
     * 1. グローバル基本設定（全デバイス共通）
     * =================================================================
     */
    *, *::before, *::after {
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans JP', 'Yu Gothic UI', Roboto, sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      max-width: 100vw;
      overflow-x: hidden;
    }
    
    /* overscroll-behaviorは一部ブラウザで!importantが必要な場合がある */
    html, body {
      overscroll-behavior-y: none !important;
    }

    /* エディタ基本設定 */
    [data-slate-editor="true"], 
    [role="textbox"], 
    .cm-editor {
      line-height: 1.4;
      touch-action: auto;
      overscroll-behavior: auto;
    }

    /* アクセシビリティ */
    @media (prefers-reduced-motion: reduce) { 
      * { 
        transition: none !important; 
        animation: none !important; 
      } 
    }
    
    button:focus, 
    input:focus, 
    textarea:focus, 
    select:focus { 
      outline: 2px solid #3b82f6; 
      outline-offset: 2px; 
    }

    /*
     * =================================================================
     * 2. マークダウンエディタ共通設定（全画面サイズ）
     * =================================================================
     */
    
    /* マークダウンプレビューボタンの統一位置（PC表示と同じ位置に固定） */
    .nc-app [class*="MarkdownControl"] [class*="PreviewPaneToggle"] {
      /* PC表示時と同じ位置に固定 */
      position: relative;
      order: 0; /* flex順序を最初に */
    }
    
    /* デスクトップレイアウト */
    @media (min-width: 800px) {
      .nc-app [class*="MarkdownControl"] {
        display: flex;
        min-height: 400px;
      }
      
      .nc-app [class*="MarkdownControl"] [class*="EditorControlPane"],
      .nc-app [class*="MarkdownControl"] [class*="PreviewPane"] {
        display: block;
        visibility: visible;
        opacity: 1;
        flex: 1;
        min-width: 50%;
      }
      
      .nc-app [class*="MarkdownControl"] [class*="PreviewPane"] {
        overflow-y: auto;
        border-left: 1px solid #e1e5e9;
        background: #fafbfc;
        padding: 16px;
      }
    }

    /*
     * =================================================================
     * 3. モバイル・タブレット専用スタイル（799px以下）
     * responsive-decapの機能を保持
     * =================================================================
     */
    @media (max-width: 799px) {
      /* === Decap CMS構造に対する高詳細度セレクタ === */
      
      /* ドロップダウンリスト */
      .nc-app div[class*=DropdownList] {
        position: fixed;
        min-width: 20%;
        width: 90%;
        margin: auto;
        height: fit-content;
        top: auto;
        left: 0;
        right: 0;
        bottom: 10px;
        background: #e6f4fd;
        border: 2px solid #3a69c7;
      }
      
      /* モーダル */
      .nc-app div[class*=StyledModal] {
        width: 90dvw;
        width: 90%;
      }
      
      /* ライブラリタイトル非表示 */
      .nc-app [class*=LibraryTitle] {
        display: none;
      }
      
      /* コレクション新規ボタン */
      .nc-app [class*=CollectionTopNewButton] {
        padding: 0 10px;
        height: auto;
      }
      
      /* ライブラリトップ */
      .nc-app [class*=LibraryTop] {
        overflow-x: auto;
        height: fit-content;
        padding-bottom: 10px;
      }
      
      /* 戻るボタン非表示 */
      .nc-app [class*=BackCollection] {
        display: none;
      }
      
      /* コントロールパネルコンテナ */
      .nc-app [class*=ControlPaneContainer] {
        padding: 0 10px;
        max-width: 100vw;
      }
      
      /* 戻るボタンとステータスのフォントサイズ */
      .nc-app [class*=BackCollection], 
      .nc-app [class*=BackStatus] {
        font-size: 0.6rem;
      }
      
      /* アプリヘッダーとメインコンテナ */
      .nc-app [class*=AppHeaderContent], 
      .nc-app [class*=AppMainContainer] {
        margin-right: 0;
        margin-left: 0;
        min-width: calc(100vw - 24px);
        max-width: 100vw;
      }
      
      /* アプリヘッダーコンテンツ */
      .nc-app [class*=AppHeaderContent] {
        display: flex;
        justify-content: space-between;
      }
      
      /* アプリヘッダークイック新規ボタン */
      .nc-app [class*=AppHeaderQuickNewButton] {
        width: 100%;
      }
      
      /* アプリヘッダーボタン */
      .nc-app [class*=AppHeaderButton] {
        padding-left: 4px;
        padding-right: 4px;
      }
      
      /* エディタとツールバーコンテナ */
      .nc-app [class*=EditorContainer], 
      .nc-app [class*=ToolbarContainer] {
        min-width: initial;
        overflow-x: auto;
      }
      
      /* ツールバーサブセクション */
      .nc-app [class*=ToolbarSubSectionFirst] {
        display: flex;
        flex-direction: row;
      }
      
      /* 公開ツールバーボタン */
      .nc-app [class*=PublishedToolbarButton] {
        padding: 0 8px;
      }
      
      .nc-app [class*=PublishedToolbarButton]::after {
        display: none;
      }
      
      /* 検索入力 */
      .nc-app [class*=SearchInput] {
        margin-top: 5px;
      }
      
      /* ビューコントロール */
      .nc-app [class*=ViewControls] {
        position: initial;
      }
      
      /* プレビューパネルコンテナ */
      .nc-app [class*=PreviewPaneContainer-ControlPaneContainer] {
        padding: 0;
      }
      
      /* エディタコントロールバー内のツールバー */
      .nc-app [class*=EditorControlBar] [class*=ToolbarContainer] {
        display: flex;
        flex-direction: column;
      }
      
      /* コレクションコンテナ */
      .nc-app [class*=CollectionContainer] {
        display: flex;
        flex-direction: column;
      }
      
      /* サイドバーコンテナ */
      .nc-app [class*=SidebarContainer] {
        position: initial;
        width: initial;
      }
      
      /* コレクションメイン */
      .nc-app [class*=CollectionMain] {
        padding-left: 0;
        margin-top: 20px;
      }

      /* === カスタム強化機能 === */
      
      /* iOS自動ズーム防止（16px以上に統一） */
      .nc-app [data-slate-editor="true"],
      .nc-app [role="textbox"],
      .nc-app .cm-editor,
      .nc-app input,
      .nc-app textarea,
      .nc-app select {
        font-size: 16px;
      }
      
      /* マークダウンエディタのモバイル最適化 */
      .nc-app [class*="MarkdownControl"] {
        flex-direction: column;
      }
      
      /* プレビューパネルのモバイル調整 */
      .nc-app [class*="MarkdownControl"] [class*="PreviewPane"] {
        border-left: none;
        border-top: 1px solid #e1e5e9;
        max-height: 300px;
        background: #fafbfc;
        padding: 16px;
      }
      
      /* プレビューボタンの統一（PCと同じ位置を維持） */
      .nc-app [class*="MarkdownControl"] [class*="ToolbarButton"],
      .nc-app [class*="MarkdownControl"] [class*="PreviewPaneToggle"] {
        /* ボタンの位置はPC表示時と同じに維持 */
        position: relative;
        margin: 0;
      }
    }

    /*
     * =================================================================
     * 4. プレビューエリアのマークダウンスタイリング（全デバイス共通）
     * =================================================================
     */
    .nc-app [class*="PreviewPane"] h1, 
    .nc-app [class*="PreviewPane"] h2, 
    .nc-app [class*="PreviewPane"] h3,
    .nc-app [class*="PreviewPane"] h4, 
    .nc-app [class*="PreviewPane"] h5, 
    .nc-app [class*="PreviewPane"] h6 {
      margin-top: 24px; 
      margin-bottom: 16px; 
      font-weight: 600; 
      line-height: 1.25;
    }
    
    .nc-app [class*="PreviewPane"] h1 { 
      font-size: 2em; 
      border-bottom: 1px solid #eaecef; 
      padding-bottom: 8px; 
    }
    
    .nc-app [class*="PreviewPane"] h2 { 
      font-size: 1.5em; 
      border-bottom: 1px solid #eaecef; 
      padding-bottom: 8px; 
    }
    
    .nc-app [class*="PreviewPane"] h3 { 
      font-size: 1.25em; 
    }
    
    .nc-app [class*="PreviewPane"] p { 
      margin-bottom: 16px; 
      line-height: 1.6; 
    }
    
    .nc-app [class*="PreviewPane"] blockquote { 
      padding: 0 1em; 
      color: #6a737d; 
      border-left: 0.25em solid #dfe2e5; 
      margin: 1em 0; 
    }
    
    .nc-app [class*="PreviewPane"] code { 
      padding: 0.2em 0.4em; 
      margin: 0; 
      font-size: 85%; 
      background-color: rgba(27,31,35,0.05); 
      border-radius: 3px; 
    }
    
    .nc-app [class*="PreviewPane"] pre { 
      padding: 16px; 
      overflow: auto; 
      font-size: 85%; 
      line-height: 1.45; 
      background-color: #f6f8fa; 
      border-radius: 6px; 
    }
    
    .nc-app [class*="PreviewPane"] img { 
      max-width: 100%; 
      height: auto; 
      border-radius: 4px; 
    }
    
    .nc-app [class*="PreviewPane"] hr { 
      border: none; 
      border-top: 1px solid #e1e4e8; 
      margin: 24px 0; 
    }
    
    .nc-app [class*="PreviewPane"] table { 
      border-collapse: collapse; 
      width: 100%; 
      margin: 16px 0; 
    }
    
    .nc-app [class*="PreviewPane"] table th,
    .nc-app [class*="PreviewPane"] table td { 
      border: 1px solid #dfe2e5; 
      padding: 8px 16px; 
    }
    
    .nc-app [class*="PreviewPane"] table th { 
      background: #f6f8fa; 
      font-weight: 600; 
    }
    
    .nc-app [class*="PreviewPane"] ul, 
    .nc-app [class*="PreviewPane"] ol { 
      padding-left: 2em; 
      margin-bottom: 16px; 
    }

    /*
     * =================================================================
     * 5. ローディング画面（全デバイス共通）
     * =================================================================
     */
    #loading-indicator {
      position: fixed; 
      top: 0; 
      left: 0; 
      width: 100%; 
      height: 100%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #ffffff; 
      display: flex; 
      align-items: center; 
      justify-content: center;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      z-index: 9999; 
      opacity: 1; 
      transition: opacity 0.5s ease-out; 
      overflow: hidden;
    }
    
    #loading-indicator .loading-bg {
      position: absolute; 
      width: 100%; 
      height: 100%;
      background-image: 
        radial-gradient(circle at 20% 30%, rgba(255, 255, 255, 0.1) 1px, transparent 1px),
        radial-gradient(circle at 70% 60%, rgba(255, 255, 255, 0.08) 1px, transparent 1px),
        radial-gradient(circle at 45% 80%, rgba(255, 255, 255, 0.12) 1px, transparent 1px);
      background-size: 200px 200px, 150px 150px, 100px 100px;
      animation: float 20s ease-in-out infinite;
    }
    
    #loading-indicator .loading-content { 
      text-align: center; 
      position: relative; 
    }
    
    #loading-indicator .loading-spinner-wrapper { 
      width: 60px; 
      height: 60px; 
      margin: 0 auto 32px; 
      position: relative; 
    }
    
    #loading-indicator .loading-spinner {
      width: 100%; 
      height: 100%; 
      border: 3px solid rgba(255, 255, 255, 0.2);
      border-radius: 50%; 
      border-top-color: rgba(255, 255, 255, 0.8);
      animation: spin 1.2s linear infinite;
    }
    
    #loading-indicator .loading-pulse {
      position: absolute; 
      top: 50%; 
      left: 50%; 
      width: 8px; 
      height: 8px;
      background: rgba(255, 255, 255, 0.6); 
      border-radius: 50%;
      transform: translate(-50%, -50%); 
      animation: pulse 2s ease-in-out infinite;
    }
    
    #loading-indicator .loading-progress-bar {
      width: 200px; 
      height: 2px; 
      background: rgba(255, 255, 255, 0.2);
      border-radius: 1px; 
      margin: 0 auto 24px; 
      overflow: hidden; 
      position: relative;
    }
    
    #loading-indicator .loading-progress-shine {
      width: 80px; 
      height: 100%;
      background: linear-gradient(90deg, transparent 0%, rgba(255, 255, 255, 0.8) 50%, transparent 100%);
      animation: progress 2s ease-in-out infinite;
    }
    
    #loading-indicator .loading-title { 
      margin: 0 0 8px; 
      font-weight: 600; 
      font-size: 22px; 
      letter-spacing: 0.5px; 
      opacity: 0.95; 
    }
    
    #loading-indicator .loading-text { 
      margin: 0; 
      opacity: 0.7; 
      font-size: 14px; 
      font-weight: 400; 
    }

    /* アニメーション定義 */
    @keyframes spin { 
      to { transform: rotate(360deg); } 
    }
    
    @keyframes pulse { 
      0%, 100% { 
        opacity: 0.6; 
        transform: translate(-50%, -50%) scale(1); 
      } 
      50% { 
        opacity: 1; 
        transform: translate(-50%, -50%) scale(1.2); 
      } 
    }
    
    @keyframes progress { 
      0% { transform: translateX(-100px); } 
      100% { transform: translateX(200px); } 
    }
    
    @keyframes float { 
      0%, 100% { transform: translateY(0px); } 
      50% { transform: translateY(-10px); } 
    }

    /*
     * =================================================================
     * 6. 必要に応じた!importantを使用する最小限のオーバーライド
     * （Decap CMSの内部スタイルが非常に高い詳細度を持つ場合のみ）
     * =================================================================
     */
    @media (max-width: 799px) {
      /* 
       * 注意: 以下は最後の手段として使用
       * 通常は上記の高詳細度セレクタで対応可能
       */
      
      /* 例: Decap CMSが inline style や高詳細度を使用している場合 */
      .nc-app [class*=DropdownList][style] {
        position: fixed !important;
      }
    }
  </style>

  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
</head>
<body>
  <div id="loading-indicator">
    <div class="loading-bg"></div>
    <div class="loading-content">
      <div class="loading-spinner-wrapper">
        <div class="loading-spinner"></div>
        <div class="loading-pulse"></div>
      </div>
      <div class="loading-progress-bar">
        <div class="loading-progress-shine"></div>
      </div>
      <h2 class="loading-title">Content Manager</h2>
      <p class="loading-text">読み込み中...</p>
    </div>
  </div>
  
  <script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>
  
  <script>
    (function() {
      // Decap CMS のルート要素にクラスを追加して詳細度を制御
      function addRootClass() {
        const root = document.querySelector('[data-react-root]') || document.body;
        if (root && !root.classList.contains('nc-app')) {
          root.classList.add('nc-app');
        }
      }
      
      function hideLoadingIndicator() {
        const loader = document.getElementById('loading-indicator');
        if (loader) {
          loader.style.opacity = '0';
          setTimeout(() => { loader.style.display = 'none'; }, 500);
        }
      }
      
      // --- 初期化 ---
      if (window.netlifyIdentity) {
        window.netlifyIdentity.on("logout", () => { document.location.href = "/admin/"; });
      }
      
      // DOMContentLoadedでルートクラスを追加
      document.addEventListener('DOMContentLoaded', addRootClass);
      
      // アプリロード後にも再度チェック
      window.addEventListener('load', () => {
        addRootClass();
        hideLoadingIndicator();
      });
      
      // MutationObserverでDecap CMSの動的要素も監視
      if (window.MutationObserver) {
        const observer = new MutationObserver(() => {
          addRootClass();
        });
        observer.observe(document.body, { childList: true, subtree: true });
      }
    })();
  </script>
</body>
</html>
